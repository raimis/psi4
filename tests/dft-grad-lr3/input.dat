#! wB97X-D test for a large UKS molecule

ref = psi4.Matrix.from_list([                         #TEST
         [  0.00000000000000,     0.00000000000000,    -0.02541973500227], #TEST
         [  0.00000000000000,    -0.00000000000000,     0.04002487283383], #TEST
         [  0.00000000000000,    -0.00000000000000,    -0.00008207795130], #TEST
         [ -0.01223116065955,    -0.00000000000000,    -0.00731033118319], #TEST
         [  0.01223116065955,     0.00000000000000,    -0.00731033118319], #TEST
         [ -0.00012619424214,    -0.00130983621357,     0.00002545245078], #TEST
         [ -0.00012619424214,     0.00130983621357,     0.00002545245078], #TEST
         [  0.00012619424214,     0.00130983621357,     0.00002545245078], #TEST
         [  0.00012619424214,    -0.00130983621357,     0.00002545245078]]) #TEST

molecule {
  -1 1
  C         0.00000000     0.00000000     2.13868804
  N         0.00000000     0.00000000     4.42197911
  C         0.00000000     0.00000000    -0.46134192
  C        -1.47758582     0.00000000    -2.82593059
  C         1.47758582     0.00000000    -2.82593059
  H        -2.41269553    -1.74021190    -3.52915989
  H        -2.41269553     1.74021190    -3.52915989
  H         2.41269553     1.74021190    -3.52915989
  H         2.41269553    -1.74021190    -3.52915989
  units bohr
}


set {
    reference             uks
    scf_type              df
    basis                 cc-pvdz
    points 5
    dft_radial_points     160
    dft_spherical_points  590
}


anl_grad = gradient('wB97X-D', dertype=1)
compare_matrices(ref, anl_grad, 6, "Analytic vs Reference wB97X-D Gradients")    #TEST

#fd_grad = gradient('wB97X-D', dertype=1)
#compare_matrices(fd, anl_grad, 4, "Analytic vs FD wB97X-D Gradients")    #TEST

# modified VV10-less B97 functional gradient wB97X-V -> wB97X-D3BJ
clean()

# stored data from finite differences
FD_wb97x_d3 = psi4.Matrix.from_list([      #TEST
   [  0.03637802044642,    0.06718963272193,    0.00000000000000], #TEST
   [  0.04955519892514,   -0.06340333481039,    0.00000000000000], #TEST
   [ -0.07009043821383,   -0.00834477190196,    0.00000000000000], #TEST
   [  0.02732425404378,   -0.05883094637658,    0.00000000000000], #TEST
   [ -0.02158351760075,    0.03169471018350,    0.05342791683461], #TEST
   [ -0.02158351760075,    0.03169471018350,   -0.05342791683461]]) #TEST

molecule {
0 1
O         -1.65542       -0.12330        0.00000
O          1.24621        0.10269        0.00000
H         -0.70409        0.03193        0.00000
H         -2.03867        0.75372        0.00000
H          1.57599       -0.38252       -0.75856
H          1.57599       -0.38252        0.75856
}

set {
    scf_type              pk
    basis                 minix
    dft_radial_points     99
    dft_spherical_points  302
    e_convergence         8
}

analytic = gradient('wB97X-D3BJ', dertype=1)
compare_matrices(analytic, FD_wb97x_d3, 5, "wB97X-D3BJ Analytic vs Store")    #TEST
